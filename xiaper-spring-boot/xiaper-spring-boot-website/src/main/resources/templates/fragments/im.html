<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <title>im</title>
</head>
<body>

    <div th:fragment="chat">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
        <script src="/js/vendor/stomp/1.2/stomp.min.js"></script>
        <script src="/js/vendor/layui/src/layui.js"></script>

        <script>

            layui.use('layim', function(layim){
                //基础配置
                layim.config({

                    //初始化接口
                    init: {
                        url: 'json/getList.json'
                        ,data: {
                            testid: 'testuserid'
                        }
                    }

                    //查看群员接口
                    ,members: {
                        url: 'json/getMembers.json'
                        ,data: {
                            testid: 'testgroupid'
                        }
                    }

                    //上传图片接口
                    ,uploadImage: {
                        url: '/upload/image' //（返回的数据格式见下文）
                        ,type: '' //默认post
                    }

                    //上传文件接口
                    ,uploadFile: {
                        url: '/upload/file' //（返回的数据格式见下文）
                        ,type: '' //默认post
                    }

                    ,isAudio: true //开启聊天工具栏音频
                    ,isVideo: true //开启聊天工具栏视频

                    // ,brief: true //是否简约模式（若开启则不显示主面板）

                    ,title: '内部会话' //自定义主面板最小化时的标题
                    ,initSkin: '3.jpg' //1-5 设置初始背景
                    ,min: true //是否始终最小化主面板，默认false
                    ,notice: true //是否开启桌面消息提醒，默认false
                    ,msgbox: layui.cache.dir + 'css/modules/layim/html/msgbox.html' //消息盒子页面地址，若不开启，剔除该项即可
                    ,find: layui.cache.dir + 'css/modules/layim/html/find.html' //发现页面地址，若不开启，剔除该项即可
                    ,chatLog: layui.cache.dir + 'css/modules/layim/html/chatlog.html' //聊天记录页面地址，若不开启，剔除该项即可
                    ,copyright: true // 隐藏下面的版权信息
                });

                //监听在线状态的切换事件
                layim.on('online', function(data){
                    console.log(data);
                });

                //监听签名修改
                layim.on('sign', function(value){
                    console.log(value);
                });

                //监听layim建立就绪
                layim.on('ready', function(res){

                });

                //监听发送消息
                layim.on('sendMessage', function(data){
                    var To = data.to;
                    console.log(data);

                    if(To.type === 'friend'){
                        layim.setChatStatus('<span style="color:#FF5722;">对方正在输入。。。</span>');
                    }
                });

                //监听查看群员
                layim.on('members', function(data){
                    console.log('members:', data);
                });

                //监听聊天窗口的切换
                layim.on('chatChange', function(res){
                    var type = res.data.type;
                    console.log('chatChange:', res.data.id)

                    if(type === 'friend'){
                        //模拟标注好友状态
                    } else if(type === 'group'){
                        //模拟系统消息
                    }
                });
            });
        </script>

    </div>

</body>
</html>